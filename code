#include <stdio.h>
#include <string.h>

#define MAX_TUTORS 100
#define MAX_NAME_LENGTH 50
#define MAX_SUBJECT_LENGTH 30

struct Tutor {
    char name[MAX_NAME_LENGTH];
    char subject[MAX_SUBJECT_LENGTH];
    float hourly_rate;
    int available;
    char studentName[MAX_NAME_LENGTH];
};

void readTutorsData(struct Tutor tutors[], int *numTutors) {
    FILE *file = fopen("teachers_database.txt", "r");
    if (file == NULL) {
        printf("Помилка відкриття файлу.\n");
        return;
    }

    while (*numTutors < MAX_TUTORS && fscanf(file, "%[^,],%[^,],%f,%d,%[^\n]\n", tutors[*numTutors].name, tutors[*numTutors].subject, &tutors[*numTutors].hourly_rate, &tutors[*numTutors].available, tutors[*numTutors].studentName) == 5) {
        (*numTutors)++;
    }

    fclose(file);
}

void displayAvailableTutors(struct Tutor tutors[], int numTutors, const char *subject) {
    printf("\nДоступні викладачі для предмету '%s':\n", subject);
    printf("-------------------------------------------------------\n");
    printf("%-20s%-20s%-15s%-15s\n", "Ім'я", "Предмет", "Ціна за заняття", "Доступність");
    printf("-------------------------------------------------------\n");

    int availableTutors = 0;
    for (int i = 0; i < numTutors; i++) {
        if (tutors[i].available && strcmp(tutors[i].subject, subject) == 0) {
            printf("%-20s%-20s%-15.2f%-15s\n", tutors[i].name, tutors[i].subject, tutors[i].hourly_rate, "Доступний");
            availableTutors++;
        }
    }

    if (availableTutors == 0) {
        printf("Немає доступних викладачів для даного предмету.\n");
    }

    printf("-------------------------------------------------------\n");
}

void bookTutor(struct Tutor tutors[], int numTutors, const char *studentName) {
    char subject[MAX_SUBJECT_LENGTH];
    printf("\n%s, введіть предмет, для якого ви хочете записатися на заняття: ", studentName);
    scanf("%s", subject);

    int found = 0;
    for (int i = 0; i < numTutors; i++) {
        if (tutors[i].available && strcmp(tutors[i].subject, subject) == 0) {
            printf("\nВи успішно записалися на заняття з предмету '%s' із викладачем %s за ціною %.2f грн.\n", subject, tutors[i].name, tutors[i].hourly_rate);
            tutors[i].available = 0;
            strcpy(tutors[i].studentName, studentName);
            found = 1;
            break;
        }
    }

    if (!found) {
        printf("\nНа жаль, немає доступних викладачів для предмету '%s'. Спробуйте інший предмет.\n", subject);
    }
}
